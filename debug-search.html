<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœç´¢åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-button { 
            background: #6366f1; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 10px 5px;
        }
        .test-button:hover { background: #4f46e5; }
        .result { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” æœç´¢åŠŸèƒ½æµ‹è¯•</h1>
        
        <h2>æµ‹è¯•1: åŸºæœ¬æœç´¢æŒ‰é’®</h2>
        <button class="test-button" onclick="testBasicSearch()">æµ‹è¯•åŸºæœ¬æœç´¢æŒ‰é’®</button>
        <div id="test1-result" class="result"></div>
        
        <h2>æµ‹è¯•2: æ¨¡æ‹Ÿæœç´¢ç»“æœ</h2>
        <button class="test-button" onclick="testSearchResults()">æµ‹è¯•æœç´¢ç»“æœæ¸²æŸ“</button>
        <div id="test2-result" class="result"></div>
        
        <h2>æµ‹è¯•3: åˆ‡æ¢åŠŸèƒ½</h2>
        <button class="test-button" onclick="testToggleFunction()">æµ‹è¯•åˆ‡æ¢åŠŸèƒ½</button>
        <div id="test3-result" class="result"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæœç´¢ç»“æœæ•°æ®
        const mockSearchResults = [
            {
                title: "æµ‹è¯•æ–‡ç« 1 - AIæŠ€æœ¯å‘å±•",
                url: "https://example.com/article1",
                snippet: "è¿™æ˜¯ä¸€ç¯‡å…³äºAIæŠ€æœ¯å‘å±•çš„æµ‹è¯•æ–‡ç« ï¼ŒåŒ…å«äº†æœ€æ–°çš„æŠ€æœ¯è¶‹åŠ¿å’Œåº”ç”¨æ¡ˆä¾‹..."
            },
            {
                title: "æµ‹è¯•æ–‡ç« 2 - æœºå™¨å­¦ä¹ åº”ç”¨",
                url: "https://example.com/article2", 
                snippet: "æœºå™¨å­¦ä¹ åœ¨å„ä¸ªé¢†åŸŸçš„åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ï¼Œä»åŒ»ç–—åˆ°é‡‘èéƒ½æœ‰é‡è¦çªç ´..."
            },
            {
                title: "æµ‹è¯•æ–‡ç« 3 - æ·±åº¦å­¦ä¹ ç ”ç©¶",
                url: "https://example.com/article3",
                snippet: "æ·±åº¦å­¦ä¹ æŠ€æœ¯æ­£åœ¨æ¨åŠ¨äººå·¥æ™ºèƒ½çš„å¿«é€Ÿå‘å±•ï¼Œæ–°çš„ç®—æ³•å’Œæ¨¡å‹ä¸æ–­æ¶Œç°..."
            }
        ];

        // æµ‹è¯•1: åŸºæœ¬æœç´¢æŒ‰é’®
        function testBasicSearch() {
            const result = document.getElementById('test1-result');
            result.innerHTML = `
                <h3>âœ… åŸºæœ¬æœç´¢æŒ‰é’®æµ‹è¯•</h3>
                <p>æ­£åœ¨æµ‹è¯•æœç´¢æŒ‰é’®çš„HTMLç”Ÿæˆ...</p>
                <div id="search-test-container"></div>
            `;
            
            // ç”Ÿæˆæœç´¢æŒ‰é’®HTML
            const searchHtml = renderSearchSources(mockSearchResults, 'test-1');
            document.getElementById('search-test-container').innerHTML = searchHtml;
        }

        // æµ‹è¯•2: æœç´¢ç»“æœæ¸²æŸ“
        function testSearchResults() {
            const result = document.getElementById('test2-result');
            result.innerHTML = `
                <h3>âœ… æœç´¢ç»“æœæ¸²æŸ“æµ‹è¯•</h3>
                <p>æµ‹è¯•æœç´¢ç»“æœçš„å®Œæ•´æ¸²æŸ“...</p>
                <div id="search-results-container"></div>
            `;
            
            const searchHtml = renderSearchSources(mockSearchResults, 'test-2');
            document.getElementById('search-results-container').innerHTML = searchHtml;
        }

        // æµ‹è¯•3: åˆ‡æ¢åŠŸèƒ½
        function testToggleFunction() {
            const result = document.getElementById('test3-result');
            result.innerHTML = `
                <h3>âœ… åˆ‡æ¢åŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•ç‚¹å‡»æŒ‰é’®çš„å±•å¼€/æ”¶èµ·åŠŸèƒ½...</p>
                <div id="toggle-test-container"></div>
            `;
            
            const searchHtml = renderSearchSources(mockSearchResults, 'test-3');
            document.getElementById('toggle-test-container').innerHTML = searchHtml;
        }

        // å¤åˆ¶renderSearchSourceså‡½æ•°ï¼ˆä»app.jsï¼‰
        function renderSearchSources(sources, messageId = null) {
            if (!sources || sources.length === 0) return '';
            
            const sourceCount = sources.length;
            const uniqueId = messageId ? `search-${messageId}` : `search-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            
            return `
                <div class="search-sources-container">
                    <button class="search-sources-toggle" onclick="toggleSearchSources('${uniqueId}')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="search-icon">
                            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>æœç´¢äº† ${sourceCount} ç¯‡ç½‘é¡µ</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="chevron-icon">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="search-sources-panel" id="${uniqueId}" style="display: none;">
                        <div class="search-sources-header">
                            <span>å‚è€ƒèµ„æ–™ (${sourceCount})</span>
                        </div>
                        <div class="search-sources-list">
                            ${sources.map((source, i) => `
                                <a href="${source.url}" target="_blank" class="search-source-item">
                                    <div class="source-number">${i + 1}</div>
                                    <div class="source-content">
                                        <div class="source-title">${escapeHtml(source.title)}</div>
                                        <div class="source-snippet">${escapeHtml(source.snippet || '').substring(0, 120)}${source.snippet?.length > 120 ? '...' : ''}</div>
                                    </div>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="external-icon">
                                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M15 3h6v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M10 14L21 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </a>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // å¤åˆ¶toggleSearchSourceså‡½æ•°ï¼ˆä»app.jsï¼‰
        window.toggleSearchSources = function(id) {
            console.log('ç‚¹å‡»æœç´¢æŒ‰é’®ï¼ŒID:', id);
            
            const panel = document.getElementById(id);
            if (!panel) {
                console.error('æ‰¾ä¸åˆ°æœç´¢ç»“æœé¢æ¿:', id);
                console.log('å½“å‰é¡µé¢æ‰€æœ‰ID:', Array.from(document.querySelectorAll('[id]')).map(el => el.id));
                return;
            }
            
            const button = panel.previousElementSibling;
            const chevron = button.querySelector('.chevron-icon');
            
            console.log('é¢æ¿å½“å‰çŠ¶æ€:', panel.style.display);
            
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                if (chevron) chevron.style.transform = 'rotate(180deg)';
                console.log('âœ… å±•å¼€æœç´¢ç»“æœ');
            } else {
                panel.style.display = 'none';
                if (chevron) chevron.style.transform = 'rotate(0deg)';
                console.log('âœ… æ”¶èµ·æœç´¢ç»“æœ');
            }
        }

        // HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>

    <!-- å¼•å…¥CSSæ ·å¼ -->
    <link rel="stylesheet" href="src/css/styles.css">
</body>
</html>
